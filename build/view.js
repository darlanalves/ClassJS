/*
 WhappJS
 Built on 2013-04-09
*/

(function(){"use strict";var t=/^\s+|\s+$/g,e=/[^0-9.]/,n=/width|height|left|top|right|bottom|minWidth|minHeight|maxWidth|maxHeight/,i={}.hasOwnProperty,s=_.isFunction,r=_.isString,a=_.isArray,o=function(t){return e.test(t)?t:t+"px"},h=_.extend,l=function(){};Whapp.define("Whapp.view.ViewAbstract",{extend:"Whapp.Component",statics:{DOMEvents:{click:!0,dblclick:!0,contextmenu:!0,mousedown:!0,mouseup:!0,mouseenter:!0,mouseleave:!0,mousemove:!0,mouseout:!0,mouseover:!0,keydown:!0,keypress:!0,keyup:!0,submit:!0},limbo:document.createDocumentFragment(),find:function(t){return t&&t.nodeType&&11===t.nodeType?t:$(t)||t}},constructor:function(t){this._initialize(t||{}),this.autoRender&&this.appendTo(this.parentNode)},delegateDomEvents:!0,hidden:!1,autoRender:!0,render:l,initialize:l,getEl:function(){return this.$el},select:function(t){return this.$el.find(t)},detach:function(){return Moovia.view.ViewAbstract.limbo.appendChild(this.$el.dom),this.parentNode=null,this},destroy:function(){return this.$el.remove(),this.clearListeners(),this.destroyed=!0},show:function(){return this.$el.show(),this.hidden=!1,this},hide:function(){return this.$el.hide(),this.hidden=!0,this},block:function(){return!this.$el||this.destroyed?!1:(this.suspendEvents(),this.$el.addCls("ui-blocked"),this.blocked=!0,this)},unblock:function(){return!this.$el||this.destroyed?!1:(this.resumeEvents(),this.$el.removeCls("ui-blocked"),this.blocked=!1,this)},setData:function(t){return this.applyData(t),this},getData:function(){return this.$data},appendTo:function(t){return this.doInsert("last",t),this},prependTo:function(t){return this.doInsert("first",t),this},insertBefore:function(t){return this.doInsert("before",t),this},insertAfter:function(t){return this.doInsert("after",t),this},className:!1,tagName:"div",template:!1,getTemplate:function(){return this.template!==!1&&(_.isFunction(this.template)||(this.template=_.template(this.template))),this.template},applyTemplate:function(t){var e=this.getTemplate();return e?e(t||this.getData()):""},doInsert:function(t,e){if(e){this.$el||(this.createView(),this.updateView());var n,i=Moovia.view.ViewAbstract.find;if(e=i(e),!e)throw Error("Container node not found");return"first"===t?(e.dom.childNodes.length>0?this.$el.insertBefore(e.dom.firstChild):this.$el.appendTo(e),this.parentNode=e):"last"===t?(this.$el.appendTo(e),this.parentNode=e):(n="before"===t?"insertBefore":"insertAfter",this.parentNode=i(e.dom.parentNode),this.$el[n](e)),this}},_initialize:function(t){if(t.renderTo&&(this.parentNode=Moovia.view.ViewAbstract.find(t.renderTo),delete t.renderTo),this.parentNode||(this.parentNode=Moovia.view.ViewAbstract.limbo),t.data){var e=t.data;delete t.data}else var e={};h(this,t),this.applyData(e,!0),this.initialize(t)},_render:function(){this.applySelectors(),this.applyAttributes(),this.render()},$el:!1,createView:function(){if(this.$el=Ext.get(document.createElement(this.tagName)),this.$el.enableDisplayMode(),this.delegateDomEvents){var t=Moovia.view.ViewAbstract.DOMEvents;this.relayEvents(this.$el,Ext.Object.getKeys(t)),this.addEvents(t),t=!1}this.applyCls(),this.applyStyles(),this.hidden&&this.hide()},updateView:function(){var t=this.applyTemplate();t&&(this.$el.dom.innerHTML=t),this._render()},$renderers:!1,getRenderers:function(){if(this.$renderers===!1){var t,e=null,n=this.getMergedWithParents("renderers")||!1;if(n){e={};for(t in n)i.call(n,t)&&s(n[t])&&(e[t]=n[t])}this.$renderers=e}return this.$renderers},$data:!1,applyData:function(t,e){var n,s=this.getRenderers();if(null!==s)for(name in s)i.call(s,name)&&i.call(t,name)&&(t[name]=s[name].call(this,t[name]!==n?t[name]:null));this.$data||(this.$data={}),_.merge(this.$data,t),e||(this.updateView(),this.fireEvent("update",this.$data))},attributes:!1,applyAttributes:function(){this.attributes!==!1&&__isObject(this.attributes)&&this.$el.set(this.attributes);var t=this.getId();this.$el.set({"data-id":this.$data.id||t,id:t})},styles:!1,applyStyles:function(t){if(t||this.styles!==!1){var e,s;if(t||(t=this.getMergedWithParents("styles")||!1),t){for(s in t)i.call(t,s)&&(e=t[s],n.test(s)&&(this[s]=e,r(prop)||(t[s]=o(e))));this.$el.setStyle(t)}}},applyCls:function(){var e=this.className;e!==!1&&(e=(a(e)?e.join(" "):e+"").replace(t,"")),this.$el.dom.className="",e&&this.$el.addCls(e)},renderSelectors:!1,childSelectors:!1,applySelectors:function(t){var e,n,s,r,e,a=this.getMergedWithParents("renderSelectors")||!1,o=this.getMergedWithParents("childSelectors")||!1;if(t=1==Boolean(t),a!==!1){for(r in a)i.call(a,r)&&(!this[r]||t)&&(e=this.select(a[r]),n=e.length,0==n?e=null:1==n&&(e=$(e.first())),this[r]=e);e=null}if(s="#"+this.getId()+"-",o!==!1)for(r in o)i.call(o,r)&&(!this[r]||t)&&(node=this.$el.select(s+o[r]),node.length>0&&(node=$(node.first())),this[r]=node)}})}).call(this),function(){Whapp.define("Whapp.view.LiveView",{extend:"Whapp.view.ViewAbstract",model:null,getModel:function(){return this.model},_initialize:function(t){if(t&&t.model){var e=this;this.model=t.model,this.model.addListener("update",function(){e.doUpdate()}),delete t.model,t.data=this.model.toJSON()}this.callParent("_initialize",t)},doUpdate:function(){this.applyData(this.model.toJSON())}})}.call(this),function(){Whapp.define("Whapp.view.LiteView",{extend:"Whapp.view.ViewAbstract"})}.call(this),function(){"use strict";function t(e,n,i){var s,o,h;for(i=i||[],s=0,o=e.length;o>s;s++)h=e[s],a(h)?n?r.apply(i,h):t(h,n,i):i.push(h);return i}var e=document,n=/:\s?/,i=/;\s?/,s=Object.prototype.toString,r=Array.prototype.push,a=function(t){return"[object Array]"==s.call(t)};Whapp.define("Whapp.view.LiveRange",{statics:{placeholderRe:RegExp("{([^}]+)}","ig"),dataLiveRe:RegExp("(.+:[^;]+);?s*","g")},constructor:function(t){this.nodes={},this.html=t},getEl:function(){return this.el},createRange:function(t,n,i){n=n||0,i=Math.abs(i),0==i&&(i=n);var s=e.createRange();return s.setStart(t,n),s.setEnd(t,i),s.extractContents(),s},build:function(t){t=t||e.createElement("div"),t.innerHTML=(a(this.html)?this.html.join(""):this.html)||"",this.el=t,this.scanNodes()},scanHtml:function(t){var e,n,i,s,r=[],a=t.childNodes;for(n=0,s=a.length;s>n;n++)e=a[n],e&&(1==e.nodeType?(i=this.scanHtml(e),i.length&&r.push(i),i=this.scanAttributes(e),i.length&&r.push(i)):(i=this.scanText(e),i.length&&r.push(i)));return r},scanAttributes:function(t){var e,s,r,a=t.getAttribute("data-live"),o=[];if(a&&(t.removeAttribute("data-live"),a=a.split(i),a.length))for(s=0,r=a.length;r>s;s++)e=a[s].split(n),o.push({node:t,name:e[1],attribute:e[0]});return o},scanText:function(t){if(1==t.nodeType||!t.nodeValue)return[];for(var e,n,i,s,r=t.nodeValue,a=[];;){if(e=Moovia.view.LiveRange.placeholderRe.exec(r),!e||!e[0])break;i=e[0],s=e[1],n=e.index,a.push({node:this.createRange(t,n,(i+"").length),name:s})}return a},scanNodes:function(){var e,n,i,s=t(this.scanHtml(this.el));if(s.length)for(e=0,n=s.length;n>e;e++)i=s[e],!this.nodes[i.name]&&(this.nodes[i.name]=[]),this.nodes[i.name].push(i)},setValue:function(t,n){var i,s,r,a;if(a=this.nodes[t],a&&a.length)for(i=0,s=a.length;s>i;i++)r=a[i],r.node instanceof Range?(n=e.createTextNode(n||""),r.node.extractContents(),r.node.insertNode(n)):r.attribute?r.node.setAttribute(r.attribute,n):r.node.innerHTML=n},update:function(t){if(t){var e;for(e in t)t.hasOwnProperty(e)&&this.setValue(e,t[e])}}})}.call(this);