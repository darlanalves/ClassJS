/*
 WhappJS
 Built on 2013-05-01
*/

Class.define("Demo",{code:"",constructor:function(t,n){this.code=t,this.output=n},build:function(t){this.code=t,this.$fn=Function("console",this.code)},run:function(){this.$fn||this.build(this.code),this.$fn.call(this,this.output)}}),Class.define("DemoEditor",{editor:null,input:null,value:"",constructor:function(t,n){this.value=t||"",this.callback=n},show:function(t){if(!this.editor){var n=this,i=0;this.editor=$('<div class="modal" />'),$("<h2>Edit test code</h2>").appendTo(this.editor),this.input=$('<textarea rows="10" cols="40" />'),this.input.on("change",function(){n.value=this.value}).on("keyup",function(){var t=this.value.split("\n").length+1;i!=t&&(n.input.attr("rows",t),i=t)}),this.input.appendTo(this.editor);var e=$('<div class="button-bar"/>');$('<button class="clear">Cancel</button>').appendTo(e).on("click",function(){n.hide()}),$('<button class="submit">Save</button>').appendTo(e).on("click",function(){n.trigger()}),this.editor.append(e).appendTo(document.body).hide()}return this.editor.fadeIn(),this.update(t),this},hide:function(){return this.editor.fadeOut(),this},update:function(t){return this.value=t,this.input.val(t).attr("rows",t.split("\n").length+1),this},trigger:function(){this.callback&&this.callback(this.value),this.hide()}}),Class.define("DemoOutput",{constructor:function(t){this.node=t},log:function(){for(var t=0,n=arguments.length,i="";n>t;t++)i+=arguments[t]+""+"\n";this.node.innerHTML+="<li><i>&bull;</i> "+i+"</li>"},debug:function(){this.log.apply(this,arguments)},clear:function(){this.node.innerHTML=""}}),$(function(){var t=Class.use("Demo","DemoOutput","DemoEditor"),n=t.DemoEditor,i=t.DemoOutput,e=t.Demo,o=$("<div/>"),s=/^\s+|\s+$/g,u=function(t){return t.replace(s,"")};$("code").each(function(t,s){var a,c,l,d,r,h,p,f=$(s),b=u(f.html());c=$('<div class="sample"/>'),f.attr("title","").html(b),d=$("<h1>"+f.attr("title")+"</h1>"),l=$('<ul class="results"/>'),r=new i(l[0]),h=new e(b,r),a=$('<div class="button-bar"><button class="clear">Clear</button><button class="edit">Edit</button><button class="submit">Run</button></div>'),a.on("click",".clear",function(){r.clear()}),a.on("click",".submit",function(){h.run()});var p;a.on("click",".edit",function(){var t=f.html();p||(p=new n(t,function(t){f.html(t),h.build(t)})),p.show(t)}),c.append(d).append(f).append(a).append(l).appendTo(o)}),o.appendTo(document.body)});