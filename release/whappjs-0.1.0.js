/*
 WhappJS
 Built on 2013-05-01
*/

(function(t){if("undefined"!=typeof require){var e=require("underscore");t={}}else var e=t._;var i,n,s=function(){},r={};i=s.prototype,e.extend(i,{superclass:void 0,self:s,_super:function(t,e){if(!t)return this.superclass;if(!this.self.prototype.hasOwnProperty(t))throw Error('Trying to call superclass method "'+t+'" from a class has not defined its own!');var i=this.superclass[t];if(!i)throw Error('Method "'+t+'" not found in parent class');return i.apply(this,e||[])}}),n=function(t,i){var s,r,a=!1;if(!t)throw Error("Trying to extend invalid class");return i&&(i.hasOwnProperty("statics")&&(a=e.extend({},i.statics),delete i.statics),i.hasOwnProperty("constructor")&&(r=i.constructor)),r||(r=function(){return t.prototype.constructor.apply(this,arguments)}),s=function(){},t&&(s.prototype=t.prototype),r.prototype=new s({$init:!1}),r.prototype.constructor=r,i&&e.extend(r.prototype,i),a&&e.extend(r,a),r.superclass=t,r.prototype.superclass=t.prototype,r.prototype.self=r,r.extend=function(t){return n(r,t)},r},s.extend=function(t){return n(this,t)},s.ns=function(i,n,s){var a,o,l,h;if(s=s||t,void 0!==r[i])s=r[i];else{if(h=i.split("."),0!==h.length)for(a=0,l=h.length;l>a;)o=h[a],s=s[o]||(s[o]={}),a+=1;r[i]=s}return n&&e.isFunction(n)&&n.call(s),s},s.get=function(e){if(void 0!==r[e])return r[e];for(var i,n=e.split("."),s=t;i=n.shift();)if(s=s[i],void 0===s)return null;return r[e]=s,s};var a=/\s{1}as\s{1}/i;s.use=function(){for(var t,e,i={},n=arguments,r=n.length;r--;)t=n[r],e=a.test(t)?t.split(a).pop():t.split(".").pop(),i[e]=s.get(t);return i},s.define=function(i,a){var o,l=i.split("."),h=l.pop(),u=s;if(ns=0===l.length?t:s.ns(l.join(".")),a&&a.hasOwnProperty("extend")){if(!e.isFunction(a.extend))throw Error("Invalid parent class!");u=a.extend,a.extend=null,delete a.extend}return ns[h]=o=n(u,a),o.$name=h,o.$className=i,r[i]=o,o},s.create=function(t,e){var i=s.get(t);if(null!==i)return new i(e);throw Error("Class not found: "+t)},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports.Class=s):t.Class=s})(this),function(){var t=[].slice,e=/\s+|,\s?/;Class.define("Whapp.EventEmitter",{pauseEvents:!1,getListeners:function(){return this._callbacks||(this._callbacks={})},addListener:function(){var i,n,s,r,a,o,l;for(a=arguments[0],i=arguments[1],s=arguments[2],l=arguments.length>=4?t.call(arguments,3):[],!i||!_.isFunction(i),a=a.split(e),n=this.getListeners();r=a.shift();)o=n[r]||(n[r]=[]),o.push({callback:i,context:s||this,params:l});return this},removeListener:function(t,i,n){var s,r,a,o,l;for(s=this.getListeners(),t||i||n||delete this._callbacks,t=t.split(e),l=[];r=t.shift();)l.push(function(){var t,e;t=this._callbacks[r],e=[];for(o in t)a=t[o],i&&i===o.callback?e.push(delete this._callbacks[r][a]):e.push(delete this._callbacks[r]);return e}.call(this));return l},trigger:function(){var i,n,s,r,a,o,l,h,u,c;if(r=arguments[0],l=arguments.length>=2?t.call(arguments,1):[],this.pauseEvents||!(n=this._callbacks))return this;for(r?(r=r.split(e),r.push("all")):r=["all"],h=!0;s=r.shift();)if(a=n[s])for(u=0,c=a.length;c>u&&(o=a[u],i=[],o.params.length&&(i=i.concat(o.params)),l.length&&(i=i.concat(l)),h=h&&o.callback.apply(o.context,i),h!==!1);u++);return h},clearListeners:function(t){var i,n,s;if(!(i=this._callbacks))return this;for(t?(t=t.split(e),t.push("all")):t=["all"],s=[];n=t.shift();)i[n]&&i[n].length?s.push(i[n]=[]):s.push(void 0);return s},once:function(t,e,i){var n,s,r=this,a=!1;return i=i||this,n=function(){r.removeListener(t,s,i),e.apply(this,arguments)},s=function(){a||(a=!0,n.apply(this,arguments),n=null)},this.on(t,s,i),this},on:function(){this.addListener.apply(this,arguments)},off:function(){this.removeListener.apply(this,arguments)},suspendEvents:function(){return this.pauseEvents=!0,this},resumeEvents:function(){return this.pauseEvents=!1,this}})}(),function(){"use strict";Whapp.namespace("Whapp.data"),Whapp.data.Types={register:function(t,e){if(Whapp.data.Types[t])throw Error("Type "+t+" is already registered!");Whapp.data.Types[t]=e},date:{convert:function(t){return t?_.isDate(t)?t:new Date(t):null}},timestamp:{convert:function(t){return new Date(1e3*t)}},time:{convert:function(t){return new Date(parseInt(t,10))}},bool:{convert:function(t){return Boolean(t)}},"int":{convert:function(t){return void 0!==t&&null!==t&&""!==t?parseInt(t.replace(/\D+/,""),10):null}},"float":{convert:function(t){return void 0!==t&&null!==t&&""!==t?parseInt(t.replace(/\D+/,""),10):null}},number:{convert:function(t){return Number(t)}},model:{convert:function(t){return t.toJSON?t.toJSON():null}},auto:{convert:function(t){return t}}}}.call(this),function(){var t=Whapp.data.Types;Whapp.define("Whapp.data.Field",{name:"",constructor:function(t){_.isString(t)&&(t={name:t}),_.extend(this,t)},getValueOf:function(t){return _.isFunction(this.convert)?this.convert(t):this.$convert(t)},$convert:function(e){var i=this.type||"auto";return t[i]?t[i].convert.call(this,e):e}})}.call(this),function(){"use strict";var t=({}.hasOwnProperty,this.Class.uuid,Whapp.data.Field);Whapp.define("Whapp.data.Model",{extend:"Whapp.Component",dirty:!1,modified:null,constructor:function(t){this.data=t,this.modified={},this.mapFields(),this.setData(t,1)},isDirty:function(){return this.dirty},isNew:function(){return null===this.$data.id},getChanges:function(){return this.modified},getRawData:function(){return this.data},getData:function(){return this.$data},setData:function(t,e){var i={};e=void 0!==e?!!e:!1,_.each(this.$fields,function(e,n){i[n]=e.getValueOf(t[n]||null)}),this.$data=i,e||this.trigger("update",this.$data)},get:function(t){return void 0!==this.$data[t]?this.$data[t]:null},set:function(t,e){this.$fields[t]&&(this.data[t]=e,this.$data[t]=this.$fields[t].getValueOf(e));var i={};return i[t]=e,_.extend(this.modified,i),this.dirty=!0,this.trigger("update",i),this},revert:function(){this.modified={},this.dirty=!1,this.trigger("revert",this)},commit:function(){0!=this.dirty&&(this.trigger("commit",this.modified,this),_.extend(this.data,this.modified),this.setData(this.modified),this.revert())},edit:function(){this.dirty=!0},toJSON:function(){return i(this.getData())},mapFields:function(){var e=this.mapping,i=this;this.fields||(this.fields=[]),e&&_.isArray(e)&&_.each(e,function(t){var e=Whapp.ClassManager.resolve(t.model),n=t.name;_.isFunction(e)&&n&&i.fields.push({name:n,type:"model",convert:function(t){if(_.isArray(t)){var i,n,s;for(i=[],n=0,s=t.length;s>n;n++)i.push(new e(t[n]))}else i=new e(t);return i}})});var n=this.fields;this.$fields={},_.isArray(n)&&_.each(n,function(e){i.$fields[e.name]=new t(e)})}});var e=function(t,i){var n,s;for(n in t)if(t.hasOwnProperty(n))if(s=t[n],s===Object(s)&&s instanceof Whapp.data.Model){var r=e(s.getData(),{});for(var a in r)r.hasOwnProperty(a)&&(i[n]||(i[n]={}),i[n][a]=r[a])}else i[n]=s;return i},i=function(t){return e(t,{})}}.call(Whapp),function(){"use strict";var t=/^\s+|\s+$/g,e=/[^0-9.]/,i=/width|height|left|top|right|bottom|minWidth|minHeight|maxWidth|maxHeight/,n={}.hasOwnProperty,s=_.isFunction,r=_.isString,a=(_.isArray,function(t){return e.test(t)?t:t+"px"}),o=_.extend,l=function(){};Whapp.define("Whapp.view.ViewAbstract",{extend:"Whapp.Component",statics:{DOMEvents:{click:!0,dblclick:!0,contextmenu:!0,mousedown:!0,mouseup:!0,mouseenter:!0,mouseleave:!0,mousemove:!0,mouseout:!0,mouseover:!0,keydown:!0,keypress:!0,keyup:!0,submit:!0},limbo:document.createDocumentFragment(),find:function(t){return t&&t.nodeType&&11===t.nodeType?t:$(t)||t}},constructor:function(t){this._initialize(t||{}),this.autoRender&&this.appendTo(this.parentNode)},delegateDomEvents:!0,hidden:!1,autoRender:!0,render:l,initialize:l,getEl:function(){return this.$el},select:function(t){return this.$el.find(t)},detach:function(){return Whapp.view.ViewAbstract.limbo.appendChild(this.$el[0]),this.parentNode=null,this},destroy:function(){return this.$el.remove(),this.clearListeners(),this.destroyed=!0},show:function(){return this.$el.show(),this.hidden=!1,this},hide:function(){return this.$el.hide(),this.hidden=!0,this},block:function(){return!this.$el||this.destroyed?!1:(this.suspendEvents(),this.$el.addClass("ui-blocked"),this.blocked=!0,this)},unblock:function(){return!this.$el||this.destroyed?!1:(this.resumeEvents(),this.$el.removeClass("ui-blocked"),this.blocked=!1,this)},setData:function(t){return this.applyData(t),this},getData:function(){return this.$data},appendTo:function(t){return this.doInsert("last",t),this},prependTo:function(t){return this.doInsert("first",t),this},insertBefore:function(t){return this.doInsert("before",t),this},insertAfter:function(t){return this.doInsert("after",t),this},className:!1,tagName:"div",template:!1,getTemplate:function(){return this.template!==!1&&(_.isFunction(this.template)||(this.template=_.template(this.template,null,{variable:"v"}))),this.template},applyTemplate:function(t){var e=this.getTemplate();return e?e(t||this.getData()):""},doInsert:function(t,e){if(e){this.$el||(this.createView(),this.updateView());var i;if(e=$(e),!e)throw Error("Container node not found");if("first"===t){var n=e.find(":first-child");n.length>0?this.$el.before(n):this.$el.append(e),this.parentNode=e}else"last"===t?(this.$el.appendTo(e),this.parentNode=e):(this.parentNode=$(e.parent()),this.$el[i](e));return this}},_initialize:function(t){if(t||(t={}),t.renderTo&&(this.parentNode=$(t.renderTo),delete t.renderTo),this.parentNode||(this.parentNode=Whapp.view.ViewAbstract.limbo),t.data){var e=t.data;delete t.data}else var e={};o(this,t),this.applyData(e,!0),this.initialize(t)},_render:function(){this.applySelectors(),this.applyAttributes(),this.render()},$el:!1,createView:function(){if(this.$el=$(document.createElement(this.tagName)),this.delegateDomEvents){var t=_.keys(t),e=this;this.$el.on(_.keys(t).join(" "),function(t){var i=_.slice(arguments);i.unshift(t.type),e.trigger.apply(e,i)}),t=!1}this.applyCls(),this.applyStyles(),this.hidden&&this.hide()},updateView:function(){var t=this.applyTemplate();t&&this.$el.html(t),this._render()},$renderers:!1,getRenderers:function(){if(this.$renderers===!1){var t,e=null,i=this.getMergedWithParents("renderers")||!1;if(i){e={};for(t in i)n.call(i,t)&&s(i[t])&&(e[t]=i[t])}this.$renderers=e}return this.$renderers},$data:!1,applyData:function(t,e){var i,s=this.getRenderers();if(null!==s)for(name in s)n.call(s,name)&&n.call(t,name)&&(t[name]=s[name].call(this,t[name]!==i?t[name]:null));this.$data||(this.$data={}),_.merge(this.$data,t),e||(this.updateView(),this.trigger("update",this.$data))},attributes:!1,applyAttributes:function(){this.attributes!==!1&&__isObject(this.attributes)&&this.$el.attr(this.attributes);var t=this.getId();this.$el.attr({"data-id":this.$data.id||t,id:t})},styles:!1,applyStyles:function(t){if(t||this.styles!==!1){var e,s;if(t||(t=this.getMergedWithParents("styles")||!1),t){for(s in t)n.call(t,s)&&(e=t[s],i.test(s)&&(this[s]=e,r(prop)||(t[s]=a(e))));this.$el.css(t)}}},applyCls:function(){var e=this.className;e!==!1&&(e=(_.isArray(e)?e.join(" "):e+"").replace(t,"")),this.$el.attr("className",""),e&&this.$el.addClass(e)},renderSelectors:!1,childSelectors:!1,applySelectors:function(t){var e,i,s,r,e,a=this.getMergedWithParents("renderSelectors")||!1,o=this.getMergedWithParents("childSelectors")||!1;if(t=1==Boolean(t),a!==!1){for(r in a)n.call(a,r)&&(!this[r]||t)&&(e=this.select(a[r]),i=e.length,0==i?e=null:1==i&&(e=$(e.first())),this[r]=e);e=null}if(s="#"+this.getId()+"-",o!==!1)for(r in o)n.call(o,r)&&(!this[r]||t)&&(node=this.select(s+o[r]),node.length>0&&(node=$(node.first())),this[r]=node)}})}.call(this),function(){Whapp.define("Whapp.view.LiveView",{extend:"Whapp.view.ViewAbstract",model:null,getModel:function(){return this.model},_initialize:function(t){if(t&&t.model){var e=this;this.model=t.model,this.model.addListener("update",function(){e.doUpdate()}),delete t.model,t.data=this.model.toJSON()}this.callParent("_initialize",[t])},doUpdate:function(){this.applyData(this.getData())},getData:function(){return this.model.toJSON()}})}.call(this),function(){Whapp.define("Whapp.view.LiteView",{extend:"Whapp.view.ViewAbstract"})}.call(this),function(){"use strict";function t(e,i,n){var s,o,l;for(n=n||[],s=0,o=e.length;o>s;s++)l=e[s],a(l)?i?r.apply(n,l):t(l,i,n):n.push(l);return n}var e=document,i=/:\s?/,n=/;\s?/,s=Object.prototype.toString,r=Array.prototype.push,a=function(t){return"[object Array]"==s.call(t)};Whapp.define("Whapp.view.LiveRange",{statics:{placeholderRe:RegExp("{([^}]+)}","ig"),dataLiveRe:RegExp("(.+:[^;]+);?s*","g")},constructor:function(t){this.nodes={},this.html=t},getEl:function(){return this.el},createRange:function(t,i,n){i=i||0,n=Math.abs(n),0==n&&(n=i);var s=e.createRange();return s.setStart(t,i),s.setEnd(t,n),s.extractContents(),s},build:function(t){t=t||e.createElement("div"),t.innerHTML=(a(this.html)?this.html.join(""):this.html)||"",this.el=t,this.scanNodes()},scanHtml:function(t){var e,i,n,s,r=[],a=t.childNodes;for(i=0,s=a.length;s>i;i++)e=a[i],e&&(1==e.nodeType?(n=this.scanHtml(e),n.length&&r.push(n),n=this.scanAttributes(e),n.length&&r.push(n)):(n=this.scanText(e),n.length&&r.push(n)));return r},scanAttributes:function(t){var e,s,r,a=t.getAttribute("data-live"),o=[];if(a&&(t.removeAttribute("data-live"),a=a.split(n),a.length))for(s=0,r=a.length;r>s;s++)e=a[s].split(i),o.push({node:t,name:e[1],attribute:e[0]});return o},scanText:function(t){if(1==t.nodeType||!t.nodeValue)return[];for(var e,i,n,s,r=t.nodeValue,a=[];;){if(e=Whapp.view.LiveRange.placeholderRe.exec(r),!e||!e[0])break;n=e[0],s=e[1],i=e.index,a.push({node:this.createRange(t,i,(n+"").length),name:s})}return a},selectText:function(t,e,i){var n,s,r=t.nodeValue;r.length>0&&(e=e===n?0:e,i=i===n?r.length:i,t.setSelectionRange?t.setSelectionRange(e,i):t.createTextRange&&(s=t.createTextRange(),s.moveStart("character",e),s.moveEnd("character",i-r.length),s.select()))},scanNodes:function(){var e,i,n,s=t(this.scanHtml(this.el));if(s.length)for(e=0,i=s.length;i>e;e++)n=s[e],!this.nodes[n.name]&&(this.nodes[n.name]=[]),this.nodes[n.name].push(n)},setValue:function(t,i){var n,s,r,a;if(a=this.nodes[t],a&&a.length)for(n=0,s=a.length;s>n;n++)r=a[n],r.node instanceof Range?(i=e.createTextNode(i||""),r.node.extractContents(),r.node.insertNode(i)):r.attribute?r.node.setAttribute(r.attribute,i):r.node.innerHTML=i},update:function(t){if(t){var e;for(e in t)t.hasOwnProperty(e)&&this.setValue(e,t[e])}}})}.call(this),function(){Whapp.define("Whapp.view.form.Button",{extend:"Whapp.view.ViewAbstract",consts:["ICON_LEFT","ICON_RIGHT","ICON_TOP","ICON_BOTTOM"],tagName:"button",template:'<span class="ui-icon {icon}" id="{id}-icon"/><span class="ui-label" id="{id}-lbl">{label}</span>',className:"ui-button",config:{icon:"",label:"",iconPos:"ICON_LEFT",name:""},childSelectors:{labelEl:"lbl",iconEl:"icon"},initComponent:function(){return this.$el.addClass("ui-"+this.iconPos.replace("_","-").toLowerCase()),this.setIcon(this.icon),this.setLabel(this.label)},setIcon:function(t){return t?(this.icon=t,this.iconEl.removeClass().addClass("ui-icon "+this.icon),this.$el.removeClass("no-icon")):this.$el.addClass("no-icon")},setLabel:function(t){return t?(this.label=t,this.labelEl.html(t),this.$el.removeClass("no-label")):this.$el.addClass("no-label")}})}.call(this),function(){var t={}.hasOwnProperty;Whapp.define("Whapp.view.form.ButtonGroup",{extend:"Whapp.view.ViewAbstract",className:"ui-buttongroup",tagName:"span",initComponent:function(){var e,i,n,s;if(this.items){n=this.items,s=[];for(i in n)t.call(n,i)&&(e=n[i],s.push(this.addButton(e)));return s}},addButton:function(t){var e;return t.renderTo=this.$el,e=new Whapp.view.form.Button(t)}})}.call(this),function(){Whapp.define("Whapp.view.form.Form",{extend:"Whapp.view.ViewAbstract",tagName:"form",className:"ui-form",serialize:function(){var t,e,i,n,s,r;if(e=this.$el.serializeArray(),i={},e.length)for(s=0,r=e.length;r>s;s++)t=e[s],n=t.name,"[]"===n.substr(-2)?(n=n.substr(0,n.length-2),_.isArray(i[n])||(i[n]=[]),i[n].push(t.value)):i[n]=t.value;return i}})}.call(this),function(){Whapp.define("Whapp.view.form.Group",{extend:"Whapp.view.ViewAbstract",className:"ui-form-group"})}.call(this),function(){Whapp.define("Whapp.view.form.Input",{extend:"Whapp.view.ViewAbstract",config:{type:"text",name:""},template:'<input type="{type}" name="{name}" class="ui-input" />',initialize:function(){return this.$el.addClass("ui-"+this.type)},update:function(t){return this.$el.val(t)},value:function(){return this.$el.val()}})}.call(this),function(){Whapp.define("Whapp.view.form.Text",{extend:"Whapp.view.ViewAbstract",config:{rows:"",columns:"",resize:!1},template:'<textarea rows="{rows}" cols="{columns}" class="ui-edit" />',initialize:function(){return this.$el.addClass("multiline"),this.resize?this.$el.addClass("resize"):void 0}})}.call(this),function(){"use strict";Whapp.define("Whapp.view.form.Toolbar",{extend:"Whapp.view.ViewAbstract",template:'<div class="ui-toolbar ui-clearfix"><div class="ui-left"></div><div class="ui-right"></div></div>',renderSelectors:{left:".ui-left",right:".ui-right"}})}.call(this);